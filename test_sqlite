# test_sqlite.py
import os
# Remove DATABASE_URL for SQLite testing
if "DATABASE_URL" in os.environ:
    del os.environ["DATABASE_URL"]

from database import MemoryDatabase

print("ðŸ§ª Testing SQLite database with notifications...")

db = MemoryDatabase()

# Test 1: Save a user
print("\n1. Saving test user...")
db.save_user_for_notifications("123456789", "test_user", "Test")

# Test 2: Get users
users = db.get_all_users_for_notifications()
print(f"2. Users in table: {len(users)}")
print(f"   User IDs: {users}")

# Test 3: Migration test
print("\n3. Testing migration...")
# Add some dummy message history first
db.add_message_to_history("111111111", "user", "Hello")
db.add_message_to_history("222222222", "assistant", "Hi there")
db.add_message_to_history("333333333", "user", "Another message")

migrated = db.migrate_existing_users()
print(f"   Migrated {migrated} users")

# Test 4: Count users
count = db.get_user_count()
print(f"4. Total active users: {count}")

# Test 5: Database stats
stats = db.get_database_stats()
print(f"\n5. Database Stats:")
for key, value in stats.items():
    print(f"   {key}: {value}")

db.close()
print("\nâœ… All SQLite tests completed successfully!")